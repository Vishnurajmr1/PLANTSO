<main>
                <!--====== Section 1 ======-->
            <div class="u-s-p-b-60">

                <!--====== Section Content ======-->
                <div class="section__content">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12">
                                <div id="checkout-msg-group">
                                    <div class="msg u-s-m-b-30">

                                        <span class="msg__text">Returning customer?

                                            <a class="gl-link" href="#return-customer" data-toggle="collapse">Click here to login</a></span>
                                        <div class="collapse" id="return-customer" data-parent="#checkout-msg-group">
                                            <div class="l-f u-s-m-b-16">

                                                <span class="gl-text u-s-m-b-16">If you have an account with us, please log in.</span>
                                                <form class="l-f__form">
                                                    <div class="gl-inline">
                                                        <div class="u-s-m-b-15">

                                                            <label class="gl-label" for="login-email">E-MAIL *</label>

                                                            <input class="input-text input-text--primary-style" type="text" id="login-email" placeholder="Enter E-mail"></div>
                                                        <div class="u-s-m-b-15">

                                                            <label class="gl-label" for="login-password">PASSWORD *</label>

                                                            <input class="input-text input-text--primary-style" type="text" id="login-password" placeholder="Enter Password"></div>
                                                    </div>
                                                    <div class="gl-inline">
                                                        <div class="u-s-m-b-15">

                                                            <button class="btn btn--e-transparent-brand-b-2" type="submit">LOGIN</button></div>
                                                        <div class="u-s-m-b-15">

                                                            <a class="gl-link" href="lost-password.html">Lost Your Password?</a></div>
                                                    </div>

                                                    <!--====== Check Box ======-->
                                                    <div class="check-box">

                                                        <input type="checkbox" id="remember-me">
                                                        <div class="check-box__state check-box__state--primary">

                                                            <label class="check-box__label" for="remember-me">Remember Me</label></div>
                                                    </div>
                                                    <!--====== End - Check Box ======-->
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="msg">

                                        <span class="msg__text">Have a coupon?

                                            <a class="gl-link" href="#have-coupon" data-toggle="collapse">Click Here to enter your code</a></span>
                                        <div class="collapse" id="have-coupon" data-parent="#checkout-msg-group">
                                            <div class="c-f u-s-m-b-16">

                                                <span class="gl-text u-s-m-b-16">Enter your coupon code if you have one.</span>
                                                <form class="c-f__form">
                                                    <div class="u-s-m-b-16">
                                                        <div class="u-s-m-b-15">

                                                            <label for="coupon"></label>

                                                            <input class="input-text input-text--primary-style" type="text" id="coupon" placeholder="Coupon Code"></div>
                                                        <div class="u-s-m-b-15">

                                                            <button class="btn btn--e-transparent-brand-b-2" type="submit">APPLY</button></div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--====== End - Section Content ======-->
            </div>
            <!--====== End - Section 1 ======-->


            <!--====== Section 3 ======-->
            <div class="u-s-p-b-60">

                <!--====== Section Content ======-->
                <div class="section__content">
                    <div class="container">
                        <div class="checkout-f">
                            <div class="row">
                                <div class="col-lg-6">
                                    <h1 class="checkout-f__h1">DELIVERY INFORMATION</h1>
                                    <form class="checkout-f__delivery">
                                       {{!-- <input type="hidden" name="_csrf" value="{{csrfToken}}"> --}}
                                        <div class="u-s-m-b-30">
                                            <div class="u-s-m-b-15">

                                                <!--====== Check Box ======-->
                                                <div class="check-box">

                                                    <input type="checkbox" id="get-address">
                                                    <div class="check-box__state check-box__state--primary">

                                                        <label class="check-box__label" for="get-address">Use default shipping and billing address from account</label></div>
                                                </div>
                                                <!--====== End - Check Box ======-->
                                            </div>

                                            <!--====== First Name, Last Name ======-->
                                            <div class="gl-inline">
                                                <div class="u-s-m-b-15">

                                                    <label class="gl-label" for="billing-fname">FIRST NAME *</label>

                                                    <input class="input-text input-text--primary-style" type="text" id="billing-fname" data-bill=""></div>
                                                <div class="u-s-m-b-15">

                                                    <label class="gl-label" for="billing-lname">LAST NAME *</label>

                                                    <input class="input-text input-text--primary-style" type="text" id="billing-lname" data-bill=""></div>
                                            </div>
                                            <!--====== End - First Name, Last Name ======-->


                                            <!--====== E-MAIL ======-->
                                            {{!-- <div class="u-s-m-b-15">

                                                <label class="gl-label" for="billing-email">E-MAIL *</label>

                                                <input class="input-text input-text--primary-style" type="text" id="billing-email" data-bill="">
                                                </div> --}}
                                            <!--====== End - E-MAIL ======-->


                                            <!--====== PHONE ======-->
                                            <div class="u-s-m-b-15">

                                                <label class="gl-label" for="billing-phone">PHONE *</label>

                                                <input class="input-text input-text--primary-style" type="text" id="billing-phone" data-bill=""></div>
                                            <!--====== End - PHONE ======-->


                                            <!--====== Street Address ======-->
                                            <div class="u-s-m-b-15">

                                                <label class="gl-label" for="billing-street">STREET ADDRESS *</label>

                                                <input class="input-text input-text--primary-style" type="text" id="billing-street" placeholder="House name and street name" data-bill=""></div>
                                            <div class="u-s-m-b-15">

                                                <label for="billing-street-optional"></label>

                                                <input class="input-text input-text--primary-style" type="text" id="billing-street-optional" placeholder="Apartment, suite unit etc. (optional)" data-bill=""></div>
                                            <!--====== End - Street Address ======-->


                                            <!--====== Country ======-->
                                            <div class="u-s-m-b-15">

                                                <!--====== Select Box ======-->

                                                <label class="gl-label" for="billing-country">COUNTRY *</label><select class="select-box select-box--primary-style" id="address-country" data-bill="">
                                                    <option selected value="">Choose Country</option>
                                                    {{#each country}}
                                                    <option value="{{code}}">{{name}}</option>
                                                    {{/each}}
                                                    {{!-- <option value="uk">United Kingdom (UK)</option>
                                                    <option value="us">United States (US)</option> --}}
                                                </select>
                                                <!--====== End - Select Box ======-->
                                            </div>
                                            <!--====== End - Country ======-->
                                            <!--====== STATE/PROVINCE ======-->
                                            <div class="u-s-m-b-15">

                                                <!--====== Select Box ======-->

                                                <label class="gl-label" for="billing-state">STATE/PROVINCE *</label><select class="select-box select-box--primary-style" id="address-state" data-bill="">
                                                    <option selected value="">Choose State/Province</option>
                                                </select>
                                                <!--====== End - Select Box ======-->
                                            </div>
                                            <!--====== End - STATE/PROVINCE ======-->
                                    <!--====== Town / City ======-->
                                            <div class="u-s-m-b-15">
                                                <label class="gl-label" for="billing-town-city">TOWN/CITY *</label>
                                                <input class="input-text input-text--primary-style" type="text" id="billing-town-city" data-bill="">
                                            </div>

                                            <!--====== End - Town / City ======-->


                                            <!--====== ZIP/POSTAL ======-->
                                            <div class="u-s-m-b-15">

                                                <label class="gl-label" for="billing-zip">ZIP/POSTAL CODE *</label>

                                                <input class="input-text input-text--primary-style" type="text" id="billing-zip" placeholder="Zip/Postal Code" data-bill=""></div>
                                            <!--====== End - ZIP/POSTAL ======-->
                                            <div class="u-s-m-b-10">

                                                <!--====== Check Box ======-->
                                                <div class="check-box">
                                                    <input type="hidden" name="addressId" id="address_id">
                                                    <input type="checkbox" id="make-default-address" data-bill="">
                                                    <div class="check-box__state check-box__state--primary">

                                                        <label class="check-box__label" for="make-default-address">Make default shipping and billing address</label></div>
                                                </div>
                                                <!--====== End - Check Box ======-->
                                            </div>
                                            <div>

                                                <button class="btn btn--e-transparent-brand-b-2" type="submit">SAVE</button></div>
                                        </div>
                                    </form>
                                </div>
                                <div class="col-lg-6">
                                    <h1 class="checkout-f__h1">ORDER SUMMARY</h1>

                                    <!--====== Order Summary ======-->
                                    <div class="o-summary">
                                    {{!-- {{#if hasProducts}} --}}
                                        <div class="o-summary__section u-s-m-b-30">
                                            <div class="o-summary__item-wrap gl-scroll">
                                                {{#each products}}
                                                <div class="o-card">
                                                    <div class="o-card__flex">
                                                        <div class="o-card__img-wrap">
                                                            <img class="u-img-fluid" src="{{this.imageUrl.[0]}}" alt="{{this.productId.title}}"></div>
                                                        <div class="o-card__info-wrap">

                                                            <span class="o-card__name">
                                                                <a href="/products/{{this.productId}}">{{this.product}}</a></span>

                                                            <span class="o-card__quantity">Quantity x {{this.quantity}}</span>

                                                            <span class="o-card__price">₹{{this.price}}</span></div>
                                                    </div>

                                                    {{!-- <a class="o-card__del far fa-trash-alt"></a> --}}
                                                </div>
                                                {{/each}}
                                                {{!-- <div class="o-card">
                                                    <div class="o-card__flex">
                                                        <div class="o-card__img-wrap">

                                                            <img class="u-img-fluid" src="images/product/electronic/product18.jpg" alt=""></div>
                                                        <div class="o-card__info-wrap">

                                                            <span class="o-card__name">

                                                                <a href="product-detail.html">Nikon DSLR Camera 4k</a></span>

                                                            <span class="o-card__quantity">Quantity x 1</span>

                                                            <span class="o-card__price">$150.00</span></div>
                                                    </div>

                                                    <a class="o-card__del far fa-trash-alt"></a>
                                                </div>
                                                <div class="o-card">
                                                    <div class="o-card__flex">
                                                        <div class="o-card__img-wrap">

                                                            <img class="u-img-fluid" src="images/product/women/product8.jpg" alt=""></div>
                                                        <div class="o-card__info-wrap">

                                                            <span class="o-card__name">

                                                                <a href="product-detail.html">New Dress D Nice Elegant</a></span>

                                                            <span class="o-card__quantity">Quantity x 1</span>

                                                            <span class="o-card__price">$150.00</span></div>
                                                    </div>

                                                    <a class="o-card__del far fa-trash-alt"></a>
                                                </div>
                                                <div class="o-card">
                                                    <div class="o-card__flex">
                                                        <div class="o-card__img-wrap">

                                                            <img class="u-img-fluid" src="images/product/men/product8.jpg" alt=""></div>
                                                        <div class="o-card__info-wrap">

                                                            <span class="o-card__name">

                                                                <a href="product-detail.html">New Fashion D Nice Elegant</a></span>

                                                            <span class="o-card__quantity">Quantity x 1</span>

                                                            <span class="o-card__price">$150.00</span></div>
                                                    </div>

                                                    <a class="o-card__del far fa-trash-alt"></a>
                                                </div> --}}
                                            </div>
                                        </div>
                                        {{!-- {{/if}} --}}
                                        <div class="o-summary__section u-s-m-b-30">
                                            <div class="o-summary__box">
                                                <h1 class="checkout-f__h1">SHIPPING & BILLING</h1>
                                                <div class="ship-b">

                                                    <span class="ship-b__text">Ship to:</span>
                                                    <div class="ship-b__box u-s-m-b-10">
                                                        <p class="ship-b__p">4247 Ashford Drive Virginia VA-20006 USA (+0) 900901904</p>

                                                        <a class="ship-b__edit btn--e-transparent-platinum-b-2" data-modal="modal" data-modal-id="#edit-ship-address">Edit</a>
                                                    </div>
                                                    <div class="ship-b__box">

                                                        <span class="ship-b__text">Bill to default billing address</span>

                                                        <a class="ship-b__edit btn--e-transparent-platinum-b-2" data-modal="modal" data-modal-id="#edit-ship-address">Edit</a></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="o-summary__section u-s-m-b-30">
                                            <div class="o-summary__box">
                                                <table class="o-summary__table">
                                                    <tbody>
                                                        <tr>
                                                            <td>SHIPPING</td>
                                                            <td>₹0.00</td>
                                                        </tr>
                                                        <tr>
                                                            <td>TAX</td>
                                                            <td>₹0.00</td>
                                                        </tr>
                                                        <tr>
                                                            <td>SUBTOTAL</td>
                                                            <td>₹{{totalSum}}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>GRAND TOTAL</td>
                                                            <td class="totalSum">₹{{totalSum}}</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="o-summary__section u-s-m-b-30">
                                            <div class="o-summary__box">
                                                <h1 class="checkout-f__h1">PAYMENT INFORMATION</h1>
                                                <form class="checkout-f__payment">
                                                 <input type="hidden" name="_csrf" value="{{csrfToken}}">
                                                    <div class="u-s-m-b-10">

                                                        <!--====== Radio Box ======-->
                                                        <div class="radio-box">

                                                            <input type="radio" id="cash-on-delivery" name="payment" value="COD">
                                                            <div class="radio-box__state radio-box__state--primary">

                                                                <label class="radio-box__label" for="cash-on-delivery">Cash on Delivery</label></div>
                                                        </div>
                                                        <!--====== End - Radio Box ======-->

                                                        <span class="gl-text u-s-m-t-6">Pay Upon Cash on delivery. (This service is only available for some countries)</span>
                                                    </div>
                                                    <div class="u-s-m-b-10">

                                                        <!--====== Radio Box ======-->
                                                        <div class="radio-box">

                                                            <input type="radio" id="direct-bank-transfer" name="payment" value="bankTransfer">
                                                            <div class="radio-box__state radio-box__state--primary">

                                                                <label class="radio-box__label" for="direct-bank-transfer">Direct Bank Transfer</label></div>
                                                        </div>
                                                        <!--====== End - Radio Box ======-->

                                                        <span class="gl-text u-s-m-t-6">Make your payment directly into our bank account. Please use your Order ID as the payment reference. Your order will not be shipped until the funds have cleared in our account.</span>
                                                    </div>
                                                    <div class="u-s-m-b-10">

                                                        <!--====== Radio Box ======-->
                                                        <div class="radio-box">

                                                            <input type="radio" id="pay-with-check" name="payment" value="PayWithCheck">
                                                            <div class="radio-box__state radio-box__state--primary">

                                                                <label class="radio-box__label" for="pay-with-check">Pay With Check</label></div>
                                                        </div>
                                                        <!--====== End - Radio Box ======-->

                                                        <span class="gl-text u-s-m-t-6">Please send a check to Store Name, Store Street, Store Town, Store State / County, Store Postcode.</span>
                                                    </div>
                                                    <div class="u-s-m-b-10">

                                                        <!--====== Radio Box ======-->
                                                        <div class="radio-box">

                                                            <input type="radio" id="pay-with-card" name="payment" value="StripePayment">
                                                            <div class="radio-box__state radio-box__state--primary">

                                                                <label class="radio-box__label" for="pay-with-card">Pay With Credit / Debit Card</label></div>
                                                        </div>
                                                        <!--====== End - Radio Box ======-->

                                                        <span class="gl-text u-s-m-t-6">International Credit Cards must be eligible for use within the United States.</span>
                                                    </div>
                                                    <div class="u-s-m-b-10">

                                                        <!--====== Radio Box ======-->
                                                        <div class="radio-box">

                                                            <input type="radio" id="pay-pal" name="payment" value="payPal">
                                                            <div class="radio-box__state radio-box__state--primary">

                                                                <label class="radio-box__label" for="pay-pal">Pay Pal</label></div>
                                                        </div>
                                                        <!--====== End - Radio Box ======-->

                                                        <span class="gl-text u-s-m-t-6">When you click "Continue" below we'll take you to Paypal's site to set up your billing information.</span>
                                                    </div>
                                                    <div class="u-s-m-b-15">

                                                        <!--====== Check Box ======-->
                                                        <div class="check-box">

                                                            <input type="checkbox" id="term-and-condition">
                                                            <div class="check-box__state check-box__state--primary">

                                                                <label class="check-box__label" for="term-and-condition">I consent to the</label></div>
                                                        </div>
                                                        <!--====== End - Check Box ======-->

                                                        <a class="gl-link">Terms of Service.</a>
                                                    </div>
                                                    <div>
                                                        <button class="btn btn--e-brand-b-2" id="order-btn">Continue</button>
                                                         {{!-- <script src="https://js.stripe.com/v3/"></script>
                                                         <script>
                                                            var stripe=Stripe('pk_test_51NM52USGoyjO6bGWzt6sBpPIgATb25DWYwIDfxfWYMKfMHMN4UxOeJj3RJy5Tgz20px7SWSnl4pMlfZr181itejI00yTNJJYdu');
                                                            var orderBtn=document.getElementById('order-btn');
                                                            orderBtn.addEventListener('click',function(){
                                                                event.preventDefault();//prevent form submission
                                                                stripe.redirectToCheckout({
                                                                    sessionId:`{{sessionId}}`
                                                                }).then(function(result){
                                                                    console.log(result);
                                                                })
                                                            });
                                                         </script> --}}
                                                        </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                    <!--====== End - Order Summary ======-->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--====== End - Section Content ======-->
            </div>
            <!--====== End - Section 3 ======-->
        </div>
        <!--====== End - App Content ======-->
        <div>
          <script src="https://js.stripe.com/v3/"></script>
        </div>
</main>


<script>
  const countries=document.getElementById('address-country')
  const states=document.getElementById('address-state')
   countries.addEventListener('change',function(){
    const selectedCountry=countries.value;
 // const csrfToken = document.querySelector('[name="_csrf"]').value;
    console.log(selectedCountry);
    //console.log(csrfToken);
     fetch(`/getStateList/${selectedCountry}`,{
     method: "GET",
     headers: {
      "Content-Type": "application/json",
    },
      //body:JSON.stringify({country:selectedCountry})
     })
     .then(response=>{
      // response.json()
      return response.json();
     })
    .then(data => {
      // Clear the state dropdown
      states.innerHTML = '<option value="">Choose State/Province</option>';
      // Populate the state dropdown with the received data
      data.forEach(state => {
        const option = document.createElement('option');
        option.value =state;
        option.textContent =state;
        states.appendChild(option);
      });
    }).catch(error=>{
      console.log(error);
     });
   });
</script>
<script>
    const getAddressCheckbox=document.getElementById('get-address');
    getAddressCheckbox.addEventListener('change',handleGetAddressChange);

    function handleGetAddressChange(){
        if(getAddressCheckbox.checked){
            console.log(getAddressCheckbox);
            retrieveDefaultAddress();
        }else{
            clearDefaultAddress();
        }
    }

    function retrieveDefaultAddress(){
        fetch('/defaultAddress',{
        method: "GET",
        headers: {
            "Content-Type": "application/json",
        },
        }).then((response)=>{
            console.log(response)
            return response.json();
        }).then((data)=>{
            console.log(data);
            if(data.error){
                Swal.fire({
                icon: 'warning',
                 title: 'No default address Found!',
                text: 'Please make any one address default',
            footer: '<a href="/addresses">Make a default address</a>'
            })
            }
            displayAddressDetails(data);
        })
        .catch((error)=>{
            console.error('Failed to retrieve default Address',error);
        })
    }

    function displayAddressDetails(address) {
  // Update the DOM elements with the address details
  // Replace the DOM element IDs with the appropriate ones from your page
     document.getElementById('billing-fname').value = address.fname;
    document.getElementById('billing-lname').value  = address.lname;
    document.getElementById('billing-phone').value  = address.phone;
    document.getElementById('billing-town-city').value = address.city;
    document.getElementById('address-country').value  = address.country;
    document.getElementById('address_id').value=address._id;
    const stateSelect=document.getElementById('address-state');
      stateSelect.innerHTML ='<option value="">Choose State/Province</option>';
      if(address.state){
       const option = document.createElement('option');
        option.value =address.state;
        option.textContent =address.state;
        option.selected=true;
        states.appendChild(option);
      }
    document.getElementById('billing-street').value  = address.street_address;
    document.getElementById('billing-zip').value  = address.zipcode;
}
    function clearAddressDetails() {
  // Clear the DOM elements displaying the address details
  // Replace the DOM element IDs with the appropriate ones from your page
        document.getElementById('billing-street').value = '';
        document.getElementById('billing-zip').value = '';
    }

    var orderBtn=document.getElementById('order-btn');
    orderBtn.addEventListener('click',function(event){
        event.preventDefault();
        handleOrder();
    });
    function handleOrder(){
        var paymentOption=document.querySelector('input[name=payment]:checked');
        if(!paymentOption){
           Swal.fire({
             icon: 'error',
                title: 'PLEASE CHOOSE',
             text: 'Select any payment method to continue!',
           // footer: '<a href="">Why do I have this issue?</a>'
})
            return;
        }
    var paymentMethodId=paymentOption.value;
    console.log(paymentMethodId);
    if(paymentMethodId==='COD' && !validateAddressDetails()){
        Swal.fire({
        title: 'Please fill the address Details',
        text: "You won't be able to continue this!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'OK'
        }).then((result) => {
        if (!result.isConfirmed) {
        Swal.fire(
         'Cancel!',
        'Checkout operation failed!',
        'error'
         )
    }
    })
        return;
    }else if(paymentMethodId==='StripePayment'){
    var stripe=Stripe('pk_test_51NM52USGoyjO6bGWzt6sBpPIgATb25DWYwIDfxfWYMKfMHMN4UxOeJj3RJy5Tgz20px7SWSnl4pMlfZr181itejI00yTNJJYdu');
      stripe.redirectToCheckout({
          sessionId:`{{sessionId}}`
         })
         .then(function(result){
              console.log(result);
          })
    }
      // Create the addressDetails object inside the handleOrder function
  var phoneNumber = document.getElementById('billing-phone').value;
  var country = document.getElementById('address-country').value;
  var state = document.getElementById('address-state').value;
  var firstName = document.getElementById('billing-fname').value;
  var lastName = document.getElementById('billing-lname').value;
  var town = document.getElementById('billing-town-city').value;
  var address = document.getElementById('billing-street').value;
  var zipCode = document.getElementById('billing-zip').value;
  var addressId=document.getElementById('address_id').value;
  //var totalPrice=document.getElementById('totalSum').value;
  const addressDetails = {
    phoneNumber: phoneNumber,
    country: country,
    state: state,
    firstName: firstName,
    lastName: lastName,
    town: town,
    address: address,
    zipCode: zipCode,
    addressId:addressId
    //totalPrice:totalPrice,

  };

  handlePayment(addressDetails,paymentMethodId);
}


function validateAddressDetails() {
  var phoneNumber = document.getElementById('billing-phone').value;
  var country = document.getElementById('address-country').value;
  var state = document.getElementById('address-state').value;
  var firstName = document.getElementById('billing-fname').value;
  var lastName = document.getElementById('billing-lname').value;
  var town = document.getElementById('billing-town-city').value;
  var address = document.getElementById('billing-street').value;
  var zipCode = document.getElementById('billing-zip').value;
  if (
    phoneNumber.trim() === '' ||
    address.trim() === '' ||
    country.trim() === '' ||
    state.trim() === '' ||
    firstName.trim() === '' ||
    lastName.trim() === '' ||
    town.trim() === '' ||
    zipCode.trim() === ''
  ) {
    return false;
  }
  return true;
}

</script>